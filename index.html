// ======================= ФУНКЦИИ ДЛЯ UNITY (ВАШ КОД, ДОПОЛНЕННЫЙ) =======================
// Функция проверки доступности рекламы (ваш код)
function checkAdsAvailable() {
    if (!window.vkBridge) {
        console.warn("VK Bridge не загружен для проверки рекламы");
        return Promise.resolve(false);
    }
    return window.vkBridge.send('VKWebAppCheckNativeAds', { ad_format: 'reward' })
        .then(data => {
            return data.result; // true если реклама доступна
        })
        .catch(err => {
            console.error("VKAd check error:", err);
            return false;
        });
}

// Глобальные функции, которые вызывает Unity (ваш код, дополненный защитой)
window.ShowRewardedAdForRevive = function () {
    console.log("ShowRewardedAdForRevive called");
    
    // 1. Проверяем готовность Unity
    if (!window.unityInstance) {
        console.error("Unity не готова. Отмена показа рекламы.");
        return;
    }
    
    // 2. Проверяем доступность VK Bridge
    if (!window.vkBridge) {
        console.warn("VK Bridge недоступен. Симулируем успех для тестов.");
        // Для тестирования вне VK: симулируем успешный показ
        setTimeout(() => {
            if (window.unityInstance) {
                window.unityInstance.SendMessage('AdManager', 'OnAdResult', 'reward_success');
            }
        }, 100);
        return;
    }
    
    // 3. Ваш основной код с проверкой доступности
    checkAdsAvailable().then(available => {
        if (available) {
            window.vkBridge.send('VKWebAppShowNativeAds', { ad_format: 'reward' })
                .then(data => {
                    if (data.result && window.unityInstance) {
                        window.unityInstance.SendMessage('AdManager', 'OnAdResult', 'reward_success');
                    } else if (window.unityInstance) {
                        window.unityInstance.SendMessage('AdManager', 'OnAdResult', 'reward_fail');
                    }
                })
                .catch(err => {
                    console.error("VKAd error:", err);
                    if (window.unityInstance) {
                        window.unityInstance.SendMessage('AdManager', 'OnAdResult', 'reward_fail');
                    }
                });
        } else {
            console.log("Rewarded ads not available");
            if (window.unityInstance) {
                window.unityInstance.SendMessage('AdManager', 'OnAdResult', 'reward_fail');
            }
        }
    });
};

// Функция для бонуса (дублирует логику, но можно изменить)
window.ShowRewardedAdForBonus = function () {
    console.log("ShowRewardedAdForBonus called");
    // Просто вызываем ту же функцию, если логика идентична
    window.ShowRewardedAdForRevive();
};
// ======================= КОНЕЦ ФУНКЦИЙ ДЛЯ UNITY =======================